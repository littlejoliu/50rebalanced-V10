<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50% æ­£2 ç­–ç•¥ (V10.0 å…¨çŸ¥å„€è¡¨æ¿)</title>
    <style>
        /* æ¨£å¼è¨­å®š */
        body { font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; background-color: #f4f6f8; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #2c3e50; padding-bottom: 10px; margin-bottom: 25px; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: #fff; transition: 0.2s; }

        /* é€£çµæŒ‰éˆ•å®¹å™¨ */
        .flex-row { display: flex; align-items: flex-end; gap: 10px; }
        .flex-grow { flex-grow: 1; }
        .link-btn { background-color: #6c757d; color: white; border: none; padding: 12px 15px; border-radius: 6px; cursor: pointer; white-space: nowrap; height: 46px; font-weight: bold; }
        .link-btn:hover { background-color: #5a6268; }

        /* åŸ·è¡ŒæŒ‰éˆ• */
        button.execute-button { background-color: #2c3e50; color: white; width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        button.execute-button:hover { background-color: #1a252f; transform: translateY(-1px); }
        
        /* çµæœå€å¡Š */
        .result-box { margin-top: 25px; padding: 25px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; display: none; }
        .result-item { margin-bottom: 12px; font-size: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        
        /* åƒè€ƒæŒ‡æ¨™è¡¨æ ¼ */
        .ref-table { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.9em; }
        .ref-table th, .ref-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .ref-table th { background-color: #e9ecef; color: #555; }
        .ref-label { text-align: left !important; font-weight: bold; color: #444; }

        /* é¡è‰²æ¨™è¨˜ */
        .highlight-green { color: #28a745; font-weight: bold; }
        .highlight-red { color: #dc3545; font-weight: bold; }
        .error-msg { color: #dc3545; text-align: center; display: none; margin-top: 10px; font-weight: bold; background-color: #ffe6e6; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>âš–ï¸ 50% æ­£2 ç­–ç•¥ (V10.0)</h2>
    
    <div class="input-group">
        <label>ğŸ’° ç›®å‰ç¾é‡‘é¤˜é¡ (å…ƒ)</label>
        <input type="number" id="cashInput" placeholder="è«‹è¼¸å…¥ç¾é‡‘é‡‘é¡">
    </div>
    <div class="input-group">
        <label>ğŸ“ˆ 00631L ç¾æœ‰å¸‚å€¼ (å…ƒ)</label>
        <input type="number" id="stockInput" placeholder="è«‹è¼¸å…¥è‚¡ç¥¨å¸‚å€¼">
    </div>
    <div class="input-group flex-row">
        <div class="flex-grow">
            <label>ğŸš¦ æ™¯æ°£ç‡ˆè™Ÿ</label>
            <select id="macroInput">
                <option value="ç¶ ç‡ˆ" selected>ç¶ ç‡ˆ (ç©©å®š)</option>
                <option value="è—ç‡ˆ">è—ç‡ˆ (ä½è¿·)</option>
                <option value="é»ƒè—ç‡ˆ">é»ƒè—ç‡ˆ (è½‰å‘)</option>
                <option value="é»ƒç´…ç‡ˆ">é»ƒç´…ç‡ˆ (è½‰å‘)</option>
                <option value="ç´…ç‡ˆ">ç´…ç‡ˆ (éç†±)</option>
            </select>
        </div>
        <button class="link-btn" onclick="window.open('https://index.ndc.gov.tw/n/zh_tw', '_blank')">ğŸ” æŸ¥ç‡ˆè™Ÿ</button>
    </div>
    <div class="input-group flex-row">
        <div class="flex-grow">
            <label>ğŸ“Š VIX æŒ‡æ•¸</label>
            <input type="number" id="vixInput" placeholder="è¼¸å…¥æ•¸å€¼" value="15">
        </div>
        <button class="link-btn" onclick="window.open('https://finance.yahoo.com/quote/%5EVIX', '_blank')">ğŸ” æŸ¥ VIX</button>
    </div>
    
    <button class="execute-button" onclick="runStrategy()">è¨ˆç®—å¹³è¡¡æ•¸æ“š</button>
    <div id="errorMsg" class="error-msg">âš ï¸ è«‹è¼¸å…¥é‡‘é¡æ‰èƒ½è¨ˆç®—ï¼</div>

    <div id="resultBox" class="result-box">
        <div class="result-item">
            <span>ğŸ“Š ç¸½è³‡ç”¢</span>
            <span id="resTotal" style="font-weight:bold;"></span>
        </div>
        <div class="result-item">
            <span>ğŸ¯ å®è§€ç›®æ¨™ (P)</span>
            <span id="resTargetLogic" style="font-weight:bold; color:#007bff;"></span>
        </div>
        <div class="result-item">
            <span>ğŸ“‰ ç›®å‰æŒå€‰</span>
            <span id="resActual"></span>
        </div>
        
        <div style="background-color: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin: 15px 0; text-align: center;">
            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">è‹¥è¦å®Œç¾å¹³è¡¡ï¼Œéœ€æ“ä½œï¼š</div>
            <div id="resAmount" style="font-size: 1.6em; font-weight: bold;"></div>
        </div>

        <div style="font-weight: bold; color: #555; margin-top: 20px;">ğŸ›¡ï¸ å®‰å…¨é‚Šç•Œåƒè€ƒ (è‡ªè¡Œåˆ¤æ–·)</div>
        <table class="ref-table">
            <thead>
                <tr>
                    <th>æ¨™æº–</th>
                    <th>å…è¨±æ³¢å‹•ç¯„åœ (%)</th>
                    <th>å…è¨±å¸‚å€¼ç¯„åœ ($)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="ref-label">ğŸ—“ï¸ å­£æª¢ (Â±10%)</td>
                    <td id="qRangePct"></td>
                    <td id="qRangeVal"></td>
                </tr>
                <tr>
                    <td class="ref-label">âš¡ å¹³æ—¥ (Â±15%)</td>
                    <td id="dRangePct"></td>
                    <td id="dRangeVal"></td>
                </tr>
            </tbody>
        </table>
        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">*è‹¥ç›®å‰å¸‚å€¼è¶…å‡ºç¯„åœï¼Œä»£è¡¨è§¸ç™¼é–€æª»</div>
    </div>
</div>

<script>
    const P_DEFAULT = 0.50; 

    function runStrategy() {
        // 1. æŠ“å–è¼¸å…¥
        let cashStr = document.getElementById('cashInput').value;
        let stockStr = document.getElementById('stockInput').value;
        let light = document.getElementById('macroInput').value;
        let vixStr = document.getElementById('vixInput').value;

        // 2. é˜²å‘†
        if (cashStr === '' || stockStr === '') {
            document.getElementById('errorMsg').style.display = 'block';
            document.getElementById('resultBox').style.display = 'none';
            return;
        }
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('resultBox').style.display = 'block';

        // 3. æ•¸å€¼è½‰æ›
        let cash = parseFloat(cashStr);
        let stock = parseFloat(stockStr);
        let vix = parseFloat(vixStr) || 15;
        let total = cash + stock;

        // 4. æ±ºå®šç›®æ¨™æ¯”ä¾‹ P
        let targetP = P_DEFAULT;
        let logicText = "ä¸­æ€§ (50%)";

        if (light === 'ç´…ç‡ˆ' && vix <= 12) {
            targetP = 0.40;
            logicText = "ğŸ”´ è²ªå©ª (40%)";
        } else if (light === 'è—ç‡ˆ' && vix >= 30) {
            targetP = 0.60;
            logicText = "ğŸ”µ ææ…Œ (60%)";
        }

        // 5. è¨ˆç®—å®Œç¾å¹³è¡¡
        let targetStockVal = total * targetP;
        let actualRatio = stock / total;
        let diffVal = targetStockVal - stock;

        // 6. è¨ˆç®—åƒè€ƒé–€æª» (Ranges)
        // å­£åº¦ +/- 10%
        let qLowerPct = (targetP * 0.90) * 100;
        let qUpperPct = (targetP * 1.10) * 100;
        let qLowerVal = total * (targetP * 0.90);
        let qUpperVal = total * (targetP * 1.10);

        // å¹³æ—¥ +/- 15%
        let dLowerPct = (targetP * 0.85) * 100;
        let dUpperPct = (targetP * 1.15) * 100;
        let dLowerVal = total * (targetP * 0.85);
        let dUpperVal = total * (targetP * 1.15);

        // 7. æ›´æ–°ä»‹é¢
        document.getElementById('resTotal').innerText = "$" + Math.round(total).toLocaleString();
        document.getElementById('resTargetLogic').innerText = logicText;
        document.getElementById('resActual').innerText = (actualRatio * 100).toFixed(2) + "%";
        
        // é¡¯ç¤ºå®Œç¾èª¿æ•´é‡‘é¡
        let amountElem = document.getElementById('resAmount');
        if (diffVal > 0) {
            amountElem.innerText = "è²·é€² " + Math.round(diffVal).toLocaleString();
            amountElem.style.color = "#28a745"; 
        } else if (diffVal < 0) {
            amountElem.innerText = "è³£å‡º " + Math.round(Math.abs(diffVal)).toLocaleString();
            amountElem.style.color = "#dc3545"; 
        } else {
            amountElem.innerText = "å®Œç¾å¹³è¡¡ (0)";
            amountElem.style.color = "#333";
        }

        // é¡¯ç¤ºåƒè€ƒè¡¨æ ¼
        document.getElementById('qRangePct').innerText = qLowerPct.toFixed(1) + "% ~ " + qUpperPct.toFixed(1) + "%";
        document.getElementById('qRangeVal').innerText = "$" + (qLowerVal/10000).toFixed(1) + "è¬ ~ $" + (qUpperVal/10000).toFixed(1) + "è¬";

        document.getElementById('dRangePct').innerText = dLowerPct.toFixed(1) + "% ~ " + dUpperPct.toFixed(1) + "%";
        document.getElementById('dRangeVal').innerText = "$" + (dLowerVal/10000).toFixed(1) + "è¬ ~ $" + (dUpperVal/10000).toFixed(1) + "è¬";
    }
</script>

</body>
</html>