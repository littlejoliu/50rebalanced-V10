<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>60/40 å­£åº¦åŸ·è¡Œç‰ˆ (V12.0)</title>
    <style>
        body { font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; background-color: #f4f6f8; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #2c3e50; padding-bottom: 10px; margin-bottom: 25px; }
        .input-group { margin-bottom: 18px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: #fff; }
        .flex-row { display: flex; align-items: flex-end; gap: 10px; }
        .flex-grow { flex-grow: 1; }
        .link-btn { background-color: #6c757d; color: white; border: none; padding: 12px 15px; border-radius: 6px; cursor: pointer; white-space: nowrap; height: 46px; font-weight: bold; }
        .link-btn:hover { background-color: #5a6268; }
        button.execute-button { background-color: #007bff; color: white; width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.2s; }
        button.execute-button:hover { background-color: #0056b3; transform: translateY(-1px); }
        .result-box { margin-top: 25px; padding: 25px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; display: none; }
        .result-item { margin-bottom: 12px; font-size: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        
        /* ç‹€æ…‹å„€è¡¨æ¿ */
        .debug-info { font-size: 14px; color: #666; background-color: #fff; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px dashed #ccc; }
        
        .highlight-green { color: #28a745; font-weight: bold; }
        .highlight-red { color: #dc3545; font-weight: bold; }
        .highlight-blue { color: #007bff; font-weight: bold; }
        .error-msg { color: #dc3545; text-align: center; display: none; margin-top: 10px; font-weight: bold; background-color: #ffe6e6; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸš€ 60% æ­£2 å­£åº¦åŸ·è¡Œç‰ˆ (V12.0)</h2>
    
    <div class="input-group">
        <label>ğŸ’° ç›®å‰ç¾é‡‘é¤˜é¡ (å…ƒ)</label>
        <input type="number" id="cashInput" placeholder="è«‹è¼¸å…¥ç¾é‡‘é‡‘é¡">
    </div>
    <div class="input-group">
        <label>ğŸ“ˆ 00631L ç¾æœ‰å¸‚å€¼ (å…ƒ)</label>
        <input type="number" id="stockInput" placeholder="è«‹è¼¸å…¥è‚¡ç¥¨å¸‚å€¼">
    </div>
    <div class="input-group flex-row">
        <div class="flex-grow">
            <label>ğŸš¦ æ™¯æ°£ç‡ˆè™Ÿ</label>
            <select id="macroInput">
                <option value="ç¶ ç‡ˆ" selected>ç¶ ç‡ˆ (ç©©å®š)</option>
                <option value="è—ç‡ˆ">è—ç‡ˆ (ä½è¿·)</option>
                <option value="é»ƒè—ç‡ˆ">é»ƒè—ç‡ˆ (è½‰å‘)</option>
                <option value="é»ƒç´…ç‡ˆ">é»ƒç´…ç‡ˆ (è½‰å‘)</option>
                <option value="ç´…ç‡ˆ">ç´…ç‡ˆ (éç†±)</option>
            </select>
        </div>
        <button class="link-btn" onclick="window.open('https://index.ndc.gov.tw/n/zh_tw', '_blank')">ğŸ” æŸ¥ç‡ˆè™Ÿ</button>
    </div>
    <div class="input-group flex-row">
        <div class="flex-grow">
            <label>ğŸ“Š VIX æŒ‡æ•¸</label>
            <input type="number" id="vixInput" placeholder="è¼¸å…¥æ•¸å€¼" value="15">
        </div>
        <button class="link-btn" onclick="window.open('https://finance.yahoo.com/quote/%5EVIX', '_blank')">ğŸ” æŸ¥ VIX</button>
    </div>
    
    <div class="input-group">
        <label>ğŸ—“ï¸ æ˜¯å¦ç‚ºå­£åº¦æª¢æŸ¥æ—¥? (3/6/9/12æœˆåº•)</label>
        <select id="quarterInput" onchange="runStrategy()"> <option value="false" selected>å¦ (å¹³æ—¥å¯¬é¬† Â±15%)</option>
            <option value="true">æ˜¯ (å­£æª¢åš´æ ¼ Â±10%)</option>
        </select>
    </div>
    
    <button class="execute-button" onclick="runStrategy()">åŸ·è¡Œç­–ç•¥åˆ¤è®€</button>
    <div id="errorMsg" class="error-msg">âš ï¸ è«‹è¼¸å…¥é‡‘é¡æ‰èƒ½è¨ˆç®—ï¼</div>

    <div id="resultBox" class="result-box">
        <div class="debug-info">
            <div>âš™ï¸ <strong>ç›®å‰æ¨¡å¼ï¼š</strong> <span id="modeStatus"></span></div>
            <div>ğŸ¯ <strong>ç›®æ¨™é…ç½®ï¼š</strong> <span id="debugTarget"></span></div>
            <div>ğŸ›¡ï¸ <strong>å®‰å…¨å€é–“ï¼š</strong> <span id="debugRange"></span> (åœ¨æ­¤ç¯„åœä¸å‹•)</div>
        </div>

        <div class="result-item">
            <span>ğŸ“Š ç¸½è³‡ç”¢</span>
            <span id="resTotal" style="font-weight:bold;"></span>
        </div>
        <div class="result-item">
            <span>ğŸ“‰ ç›®å‰æŒå€‰</span>
            <span id="resActual"></span>
        </div>
        
        <div class="result-item">
            <span>ğŸ‘‰ åŸ·è¡ŒæŒ‡ä»¤</span>
            <span id="resAction" style="font-size:1.3em;"></span>
        </div>
        <div class="result-item" style="border:none; margin-top:10px;">
            <span>ğŸ’° å»ºè­°äº¤æ˜“é‡‘é¡</span>
            <span id="resAmount" style="font-size:1.2em;"></span>
        </div>
    </div>
</div>

<script>
    // åƒæ•¸è¨­å®š (æˆé•·ç‰ˆ 60/40)
    const P_DEFAULT = 0.60; 
    const THRESHOLD_EMERGENCY = 0.15; // å¹³æ—¥ 15%
    const THRESHOLD_QUARTER = 0.10;   // å­£æª¢ 10%

    function runStrategy() {
        let cashStr = document.getElementById('cashInput').value;
        let stockStr = document.getElementById('stockInput').value;
        let light = document.getElementById('macroInput').value;
        let vixStr = document.getElementById('vixInput').value;
        let isQuarter = document.getElementById('quarterInput').value === 'true';

        if (cashStr === '' || stockStr === '') {
            // è‹¥é‚„æ²’è¼¸å…¥æ•¸å­—ï¼Œå…ˆä¸é¡¯ç¤ºéŒ¯èª¤ï¼Œç­‰æŒ‰æŒ‰éˆ•å†èªª
            // ä½†å¦‚æœå·²ç¶“æœ‰çµæœæ¡†äº†ï¼Œå°±å³æ™‚æ›´æ–°
            if(document.getElementById('resultBox').style.display === 'block') {
                 // continue to update
            } else {
                return; 
            }
        } else {
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('resultBox').style.display = 'block';
        }

        let cash = parseFloat(cashStr);
        let stock = parseFloat(stockStr);
        let vix = parseFloat(vixStr) || 15;
        let total = cash + stock;

        // 1. æ±ºå®šç›®æ¨™ P (60% åŸºæº–)
        let targetP = P_DEFAULT;
        let logicText = "ä¸­æ€§ (60%)";

        if (light === 'ç´…ç‡ˆ' && vix <= 12) {
            targetP = 0.50; // è²ªå©ªé™è‡³ 50%
            logicText = "ğŸ”´ è²ªå©ªé™é€Ÿ (50%)";
        } else if (light === 'è—ç‡ˆ' && vix >= 30) {
            targetP = 0.70; // ææ…Œå‡è‡³ 70%
            logicText = "ğŸ”µ ææ…ŒåŠ é€Ÿ (70%)";
        }

        let targetStockVal = total * targetP;
        let actualRatio = stock / total;
        let action = "ç¶­æŒä¸è®Š";
        let tradeVal = 0;
        let actionClass = "highlight-blue";

        // 2. æ±ºå®šé–€æª» (Dynamic Threshold)
        let threshold = isQuarter ? THRESHOLD_QUARTER : THRESHOLD_EMERGENCY;
        let upperLimit = targetP * (1 + threshold);
        let lowerLimit = targetP * (1 - threshold);
        
        let modeText = isQuarter ? "ğŸ—“ï¸ å­£åº¦æª¢æŸ¥ (Â±10%)" : "âš¡ å¹³æ—¥ç›£æ§ (Â±15%)";

        // 3. åˆ¤æ–·é‚è¼¯
        if (actualRatio >= upperLimit) {
            action = isQuarter ? "å­£åº¦è³£å‡º" : "ç·Šæ€¥è³£å‡º";
            tradeVal = stock - targetStockVal; // å›æ­¸ç›®æ¨™
            actionClass = "highlight-red";
        } else if (actualRatio <= lowerLimit) {
            action = isQuarter ? "å­£åº¦è²·å…¥" : "ç·Šæ€¥è²·å…¥";
            tradeVal = targetStockVal - stock; // å›æ­¸ç›®æ¨™
            actionClass = "highlight-green";
        }

        // 4. æ›´æ–° UI
        document.getElementById('resTotal').innerText = "$" + Math.round(total).toLocaleString();
        document.getElementById('resActual').innerText = (actualRatio * 100).toFixed(2) + "%";
        
        let actSpan = document.getElementById('resAction');
        actSpan.innerText = action;
        actSpan.className = actionClass;

        let amtSpan = document.getElementById('resAmount');
        if (tradeVal > 0) {
            let prefix = action.includes("è³£å‡º") ? "è³£å‡º " : "è²·å…¥ ";
            amtSpan.innerText = prefix + "$" + Math.round(tradeVal).toLocaleString();
            amtSpan.className = actionClass;
        } else {
            amtSpan.innerText = "ç„¡éœ€äº¤æ˜“";
            amtSpan.className = "highlight-blue";
        }

        // æ›´æ–°å„€è¡¨æ¿
        document.getElementById('modeStatus').innerText = modeText;
        document.getElementById('debugTarget').innerText = logicText;
        document.getElementById('debugRange').innerText = `${(lowerLimit*100).toFixed(1)}% ~ ${(upperLimit*100).toFixed(1)}%`;
    }
</script>

</body>
</html>
